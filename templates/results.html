{% extends "base.html" %}
{% block content %}

<div class="container mt-4">
  <h2>Rezultati Analiz</h2>
  
  <!-- Bootstrap Nav-Tabs -->
  <ul class="nav nav-pills" id="analysisTabs" role="tablist">
    {% for analysis_result in analysis_results %}
    <li class="nav-item" role="presentation">
      <button class="nav-link {% if loop.first %}active{% endif %} m-1" style="border: solid 2px rgb(140, 140, 151);" id="tab-{{ loop.index }}" data-bs-toggle="tab" data-bs-target="#analysis-{{ loop.index }}" type="button" role="tab" aria-controls="analysis-{{ loop.index }}" aria-selected="{% if loop.first %}true{% else %}false{% endif %}">
        {{ analysis_result.analysis_name }}
      </button>
    </li>
    {% endfor %}
  </ul>
  
  <div class="tab-content" id="analysisTabsContent">
    {% for analysis_result in analysis_results %}
    <div class="tab-pane fade {% if loop.first %}show active{% endif %}" id="analysis-{{ loop.index }}" role="tabpanel" aria-labelledby="tab-{{ loop.index }}">
      
      <h3 class="mt-3">Metoda: {{ analysis_result.method }}</h3>
      
      <!-- Prikaz Decision Matrix -->
      <p><strong>Matrika odlo훾anja:</strong></p>
      <div class="table-responsive">
        {{ analysis_result.matrix_html | safe }}
      </div>
      
      <!-- Prikaz Ute탑i -->
      <p><strong>Ute탑i (normalizirane):</strong></p>
      <ul>
        {% for weight in analysis_result.weights %}
        <li>{{ weight }}</li>
        {% endfor %}
      </ul>
      
      <!-- Prikaz Razvrstitve -->
      <h4>Razvrstitev:</h4>
      <table class="table table-striped table-hover border-primary table-sm">
        <thead>
          <tr>
            <th>Rang</th>
            <th>Podjetje</th>
            <th>Rezultat</th>
          </tr>
        </thead>
        <tbody>
          {% for r in analysis_result.ranking %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ r.company }}</td>
            <td>{{ r.score }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      
      <!-- Chart.js Graf -->
      <h4>Graf Razvrstitve</h4>
      <canvas id="chart-{{ loop.index }}" width="600" height="300"></canvas>
      
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script>
        const ctx{{ loop.index }} = document.getElementById('chart-{{ loop.index }}').getContext('2d');
        const myChart{{ loop.index }} = new Chart(ctx{{ loop.index }}, {
          type: 'bar',
          data: {
            labels: {{ analysis_result.ranking | map(attribute='company') | list | tojson }},
            datasets: [{
              label: 'MCDA Score',
              data: {{ analysis_result.ranking | map(attribute='score') | list | tojson }},
              backgroundColor: 'rgba(54, 162, 235, 0.5)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
                max: 1
              }
            }
          }
        });
      </script>
      
    </div>
    {% endfor %}
  </div>
</div>

<!-- Bootstrap JS (vklju훾uje Popper.js) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

{% endblock %}
